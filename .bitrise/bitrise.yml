format_version: '11'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
    - opts:
        is_expand: false
      APP_STORE_CONNECT_ISSUER_ID: $APP_STORE_CONNECT_ISSUER_ID
    - opts:
        is_expand: false
      APP_STORE_CONNECT_KEY_ID: $APP_STORE_CONNECT_KEY_ID
    - opts:
        is_expand: false
      APP_STORE_CONNECT_PRIVATE_KEY: $APP_STORE_CONNECT_PRIVATE_KEY
    - opts:
        is_expand: false
      MATCH_PASSWORD: $MATCH_PASSWORD
    - opts:
        is_expand: false
      GH_TOKEN: $GH_TOKEN
    - opts:
        is_expand: false
      SLACK_WEBHOOK_URL: $SLACK_WEBHOOK_URL

workflows:
  primary:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8: {}
    - fastlane@3:
        inputs:
        - lane: ios ci_build
        - work_dir: $BITRISE_SOURCE_DIR
    - deploy-to-bitrise-io@2: {}

  dry_run:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8: {}
    - fastlane@3:
        inputs:
        - lane: ios dry_run
        - work_dir: $BITRISE_SOURCE_DIR

  release:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8: {}
    - fastlane@3:
        inputs:
        - lane: ios ci_release
        - work_dir: $BITRISE_SOURCE_DIR
    - deploy-to-bitrise-io@2: {}
